<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DanielGamer Tetris - Vers√£o Melhorada</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Orbitron', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .game-container {
            background: rgba(0, 0, 0, 0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 0 50px rgba(102, 126, 234, 0.5);
            border: 2px solid #667eea;
            position: relative;
            max-width: 100vw;
            max-height: 100vh;
        }

        .title {
            text-align: center;
            color: #00ff88;
            font-size: 2.5em;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #00ff88;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px #00ff88; }
            to { text-shadow: 0 0 30px #00ff88, 0 0 40px #00ff88; }
        }

        .game-area {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            justify-content: center;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .character-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            background: linear-gradient(45deg, #333, #555);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #00ff88;
            font-size: 14px;
            text-align: center;
            font-weight: bold;
        }

        .score-board {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 12px;
            color: #00ff88;
            text-align: center;
            min-width: 120px;
        }

        .score-board h3 {
            margin-bottom: 8px;
            font-size: 1em;
        }

        .score {
            font-size: 1.3em;
            font-weight: bold;
        }

        .game-board {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #gameCanvas {
            border: 3px solid #00ff88;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
            background: #000;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .next-piece {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 12px;
            color: #00ff88;
            text-align: center;
        }

        .next-piece h3 {
            margin-bottom: 8px;
            font-size: 1em;
        }

        #nextCanvas {
            border: 1px solid #00ff88;
            border-radius: 5px;
            background: #000;
        }

        .controls {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 12px;
            color: #00ff88;
        }

        .controls h3 {
            margin-bottom: 8px;
            text-align: center;
            font-size: 1em;
        }

        .controls p {
            margin: 3px 0;
            font-size: 0.8em;
        }

        /* Controles de Toque */
        .touch-controls {
            display: none;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .touch-row {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .touch-btn {
            background: rgba(0, 255, 136, 0.2);
            border: 2px solid #00ff88;
            border-radius: 8px;
            color: #00ff88;
            font-family: 'Orbitron', monospace;
            font-weight: bold;
            font-size: 14px;
            padding: 12px 16px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
            min-width: 50px;
            text-align: center;
        }

        .touch-btn:active {
            background: rgba(0, 255, 136, 0.4);
            transform: scale(0.95);
        }

        .touch-btn:hover {
            background: rgba(0, 255, 136, 0.3);
        }

        /* Overlays */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 20px;
            z-index: 100;
        }

        .menu-screen {
            color: #00ff88;
            text-align: center;
        }

        .menu-screen h1 {
            font-size: 3em;
            margin-bottom: 30px;
            text-shadow: 0 0 30px #00ff88;
            animation: glow 2s ease-in-out infinite alternate;
        }

        .menu-btn {
            background: rgba(0, 255, 136, 0.2);
            border: 2px solid #00ff88;
            border-radius: 10px;
            color: #00ff88;
            font-family: 'Orbitron', monospace;
            font-weight: bold;
            font-size: 16px;
            padding: 15px 30px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
        }

        .menu-btn:hover {
            background: rgba(0, 255, 136, 0.4);
            transform: scale(1.05);
        }

        .game-over {
            color: #ff4444;
            text-align: center;
        }

        .game-over h2 {
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 0 0 20px #ff4444;
        }

        .game-over .final-stats {
            margin: 20px 0;
            font-size: 1.2em;
        }

        .pause-overlay {
            color: #00ff88;
            text-align: center;
            font-size: 1.5em;
        }

        .high-scores {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #00ff88;
        }

        .high-scores h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .score-entry {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
        }

        /* Media Queries para Mobile - Layout Otimizado */
        @media (max-width: 768px) {
            body {
                overflow: hidden;
                padding: 0;
                margin: 0;
            }

            .game-container {
                padding: 8px;
                width: 100vw;
                height: 100vh;
                max-width: 100vw;
                max-height: 100vh;
                border-radius: 0;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }

            .title {
                font-size: 1.5em;
                margin-bottom: 8px;
            }

            .game-area {
                flex-direction: column;
                gap: 8px;
                flex: 1;
                justify-content: space-between;
                align-items: center;
                min-height: 0;
            }

            .left-panel {
                flex-direction: row;
                gap: 6px;
                width: 100%;
                justify-content: space-around;
                flex-wrap: wrap;
                order: 1;
            }

            .character-image {
                width: 50px;
                height: 50px;
                font-size: 8px;
            }

            .score-board {
                padding: 4px;
                min-width: 60px;
                flex: 1;
                max-width: 80px;
            }

            .score-board h3 {
                font-size: 0.7em;
                margin-bottom: 2px;
            }

            .score {
                font-size: 0.9em;
            }

            .game-board {
                order: 2;
                flex: 1;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                min-height: 0;
                gap: 5px;
            }

            #gameCanvas {
                width: 200px;
                height: 350px;
                max-width: 85vw;
                max-height: 40vh;
            }

            .touch-controls {
                display: flex !important;
                flex-direction: column;
                gap: 5px;
                width: 100%;
                justify-content: center;
                align-items: center;
            }

            .next-piece {
                padding: 6px;
                flex: 1;
                max-width: 100px;
            }

            .next-piece h3 {
                font-size: 0.7em;
            }

            #nextCanvas {
                width: 50px;
                height: 50px;
            }

            .controls {
                padding: 6px;
                flex: 1;
                max-width: 120px;
            }

            .controls h3 {
                font-size: 0.7em;
            }

            .controls p {
                font-size: 0.6em;
                margin: 1px 0;
            }

            .touch-controls {
                display: flex !important;
                margin-top: 5px;
                order: 4;
                width: 100%;
                justify-content: center;
            }

            .touch-btn {
                font-size: 10px;
                padding: 6px 8px;
                min-width: 35px;
            }

            .menu-screen h1 {
                font-size: 1.8em;
                margin-bottom: 15px;
            }

            .menu-btn {
                font-size: 12px;
                padding: 10px 15px;
                min-width: 120px;
            }

            .game-over h2 {
                font-size: 1.5em;
            }

            .high-scores {
                padding: 10px;
                margin: 10px 0;
            }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 1.5em;
                margin-bottom: 8px;
            }

            .character-image {
                width: 50px;
                height: 50px;
                font-size: 8px;
            }

            .score-board {
                padding: 4px;
                min-width: 60px;
                max-width: 80px;
            }

            .score-board h3 {
                font-size: 0.7em;
            }

            .score {
                font-size: 0.9em;
            }

            #gameCanvas {
                width: 200px;
                height: 400px;
            }

            #nextCanvas {
                width: 50px;
                height: 50px;
            }

            .touch-btn {
                font-size: 10px;
                padding: 6px 8px;
                min-width: 35px;
            }

            .controls p {
                font-size: 0.6em;
            }
        }

        /* Anima√ß√µes */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .overlay {
            animation: fadeIn 0.3s ease-in-out;
        }

        .menu-screen, .game-over, .pause-overlay {
            animation: slideIn 0.5s ease-out;
        }

        /* Efeitos de part√≠culas */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #00ff88;
            border-radius: 50%;
            pointer-events: none;
            animation: particle-fall 1s ease-out forwards;
        }

        @keyframes particle-fall {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(50px) scale(0.5);
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Menu Principal -->
        <div id="menuScreen" class="overlay">
            <div class="menu-screen">
                <h1>üéÆ DANIELGAMER TETRIS üéÆ</h1>
                <button class="menu-btn" onclick="startGame()">INICIAR JOGO</button>
                <button class="menu-btn" onclick="showHighScores()">RECORDES</button>
                <button class="menu-btn" onclick="showInstructions()">INSTRU√á√ïES</button>
            </div>
        </div>

        <!-- Tela de Recordes -->
        <div id="highScoresScreen" class="overlay" style="display: none;">
            <div class="menu-screen">
                <h1>üèÜ RECORDES üèÜ</h1>
                <div class="high-scores">
                    <div id="highScoresList"></div>
                </div>
                <button class="menu-btn" onclick="showMenu()">VOLTAR</button>
            </div>
        </div>

        <!-- Tela de Instru√ß√µes -->
        <div id="instructionsScreen" class="overlay" style="display: none;">
            <div class="menu-screen">
                <h1>üìñ INSTRU√á√ïES üìñ</h1>
                <div class="high-scores">
                    <p><strong>Objetivo:</strong> Encaixe as pe√ßas para formar linhas completas</p>
                    <p><strong>Controles PC:</strong></p>
                    <p>‚Üê ‚Üí : Mover pe√ßa</p>
                    <p>‚Üì : Acelerar queda</p>
                    <p>‚Üë : Rotacionar pe√ßa</p>
                    <p>Espa√ßo : Queda instant√¢nea</p>
                    <p>P : Pausar</p>
                    <p>R : Reiniciar</p>
                    <p><strong>Mobile:</strong> Use os bot√µes na tela</p>
                </div>
                <button class="menu-btn" onclick="showMenu()">VOLTAR</button>
            </div>
        </div>

        <h1 class="title">üéÆ DANIELGAMER üéÆ</h1>
        
        <div class="game-area">
            <div class="left-panel">
                <div class="character-image" id="characterImage">
                    üéÆ DANIEL üéÆ
                </div>
                
                <div class="score-board">
                    <h3>PONTUA√á√ÉO</h3>
                    <div class="score" id="score">0</div>
                </div>
                
                <div class="score-board">
                    <h3>N√çVEL</h3>
                    <div class="score" id="level">1</div>
                </div>
                
                <div class="score-board">
                    <h3>LINHAS</h3>
                    <div class="score" id="lines">0</div>
                </div>
            </div>

            <div class="game-board">
                <canvas id="gameCanvas" width="300" height="600"></canvas>
                
                <!-- Controles de Toque -->
                <div class="touch-controls">
                    <div class="touch-row">
                        <button class="touch-btn" id="rotateBtn">‚Üª</button>
                        <button class="touch-btn" id="hardDropBtn">‚¨á‚¨á</button>
                        <button class="touch-btn" id="pauseBtn">‚è∏</button>
                    </div>
                    <div class="touch-row">
                        <button class="touch-btn" id="leftBtn">‚Üê</button>
                        <button class="touch-btn" id="downBtn">‚Üì</button>
                        <button class="touch-btn" id="rightBtn">‚Üí</button>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="next-piece">
                    <h3>PR√ìXIMA PE√áA</h3>
                    <canvas id="nextCanvas" width="120" height="120"></canvas>
                </div>
                
                <div class="controls">
                    <h3>CONTROLES</h3>
                    <p>‚Üê ‚Üí : Mover</p>
                    <p>‚Üì : Acelerar</p>
                    <p>‚Üë : Rotacionar</p>
                    <p>Espa√ßo : Hard Drop</p>
                    <p>P : Pausar</p>
                    <p>R : Reiniciar</p>
                </div>
            </div>
        </div>

        <!-- Game Over -->
        <div id="gameOverScreen" class="overlay" style="display: none;">
            <div class="game-over">
                <h2>GAME OVER!</h2>
                <div class="final-stats">
                    <p>Pontua√ß√£o Final: <span id="finalScore">0</span></p>
                    <p>N√≠vel Alcan√ßado: <span id="finalLevel">1</span></p>
                    <p>Linhas Limpas: <span id="finalLines">0</span></p>
                </div>
                <button class="menu-btn" onclick="restartGame()">JOGAR NOVAMENTE</button>
                <button class="menu-btn" onclick="showMenu()">MENU PRINCIPAL</button>
            </div>
        </div>

        <!-- Pause -->
        <div id="pauseScreen" class="overlay" style="display: none;">
            <div class="pause-overlay">
                <h2>JOGO PAUSADO</h2>
                <p>Pressione P ou clique em Continuar</p>
                <button class="menu-btn" onclick="togglePause()">CONTINUAR</button>
                <button class="menu-btn" onclick="showMenu()">MENU PRINCIPAL</button>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes do jogo
        const CONFIG = {
            BOARD_WIDTH: 10,
            BOARD_HEIGHT: 20,
            BLOCK_SIZE: 30,
            DROP_INTERVAL_BASE: 1000,
            DROP_INTERVAL_MIN: 100,
            LEVEL_SPEED_INCREASE: 100,
            LINES_PER_LEVEL: 10,
            POINTS: {
                SOFT_DROP: 1,
                HARD_DROP: 2,
                SINGLE: 100,
                DOUBLE: 300,
                TRIPLE: 500,
                TETRIS: 800
            }
        };

        // Estado do jogo
        class GameState {
            constructor() {
                this.reset();
            }

            reset() {
                this.board = Array(CONFIG.BOARD_HEIGHT).fill().map(() => Array(CONFIG.BOARD_WIDTH).fill(0));
                this.currentPiece = null;
                this.nextPiece = null;
                this.gameRunning = false;
                this.paused = false;
                this.score = 0;
                this.level = 1;
                this.lines = 0;
                this.dropTime = 0;
                this.lastTime = 0;
                this.combo = 0;
            }
        }

        // Cores das pe√ßas (cores mais vibrantes)
        const COLORS = [
            '#000000', // vazio
            '#FF6B6B', // I - vermelho
            '#4ECDC4', // O - turquesa
            '#45B7D1', // T - azul
            '#96CEB4', // S - verde
            '#FFEAA7', // Z - amarelo
            '#DDA0DD', // J - roxo
            '#FFB347'  // L - laranja
        ];

        // Formas das pe√ßas Tetris
        const PIECES = [
            // I
            [
                [0,0,0,0],
                [1,1,1,1],
                [0,0,0,0],
                [0,0,0,0]
            ],
            // O
            [
                [2,2],
                [2,2]
            ],
            // T
            [
                [0,3,0],
                [3,3,3],
                [0,0,0]
            ],
            // S
            [
                [0,4,4],
                [4,4,0],
                [0,0,0]
            ],
            // Z
            [
                [5,5,0],
                [0,5,5],
                [0,0,0]
            ],
            // J
            [
                [6,0,0],
                [6,6,6],
                [0,0,0]
            ],
            // L
            [
                [0,0,7],
                [7,7,7],
                [0,0,0]
            ]
        ];

        // Inst√¢ncias globais
        let gameState = new GameState();
        let canvas, ctx, nextCanvas, nextCtx;
        let audioContext, isPlayingMusic = false;

        // Inicializa√ß√£o
        function initGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            nextCanvas = document.getElementById('nextCanvas');
            nextCtx = nextCanvas.getContext('2d');

            setupEventListeners();
            setupTouchControls();
            loadHighScores();
            
            // Inicializar √°udio ap√≥s intera√ß√£o do usu√°rio
            document.addEventListener('click', initAudio, { once: true });
            document.addEventListener('keydown', initAudio, { once: true });
        }

        // Configurar event listeners
        function setupEventListeners() {
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
        }

        // Configurar controles de toque
        function setupTouchControls() {
            const touchButtons = {
                leftBtn: () => movePiece(-1, 0),
                rightBtn: () => movePiece(1, 0),
                downBtn: () => movePiece(0, 1),
                rotateBtn: () => rotatePiece(),
                hardDropBtn: () => hardDrop(),
                pauseBtn: () => togglePause()
            };

            Object.entries(touchButtons).forEach(([id, action]) => {
                const btn = document.getElementById(id);
                if (btn) {
                    btn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        if (gameState.gameRunning && !gameState.paused) {
                            action();
                        }
                    });
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        if (gameState.gameRunning && !gameState.paused) {
                            action();
                        }
                    });
                }
            });
        }

        // Controles do teclado
        function handleKeyDown(e) {
            if (e.key === 'p' || e.key === 'P') {
                togglePause();
                return;
            }
            
            if (e.key === 'r' || e.key === 'R') {
                if (gameState.gameRunning) {
                    restartGame();
                }
                return;
            }
            
            if (!gameState.gameRunning || gameState.paused) {
                return;
            }
            
            switch (e.key) {
                case 'ArrowLeft':
                    movePiece(-1, 0);
                    break;
                case 'ArrowRight':
                    movePiece(1, 0);
                    break;
                case 'ArrowDown':
                    movePiece(0, 1);
                    break;
                case 'ArrowUp':
                    rotatePiece();
                    break;
                case ' ':
                    e.preventDefault();
                    hardDrop();
                    break;
            }
        }

        function handleKeyUp(e) {
            // Implementar se necess√°rio para controles cont√≠nuos
        }

        // Criar nova pe√ßa
        function createPiece() {
            const pieceIndex = Math.floor(Math.random() * PIECES.length);
            const shape = PIECES[pieceIndex].map(row => [...row]);
            return {
                shape: shape,
                x: Math.floor(CONFIG.BOARD_WIDTH / 2) - Math.floor(shape[0].length / 2),
                y: 0,
                type: pieceIndex + 1
            };
        }

        // Verificar movimento v√°lido
        function isValidMove(piece, newX, newY, newShape = null) {
            if (!piece) return false;
            
            const shape = newShape || piece.shape;
            
            for (let y = 0; y < shape.length; y++) {
                for (let x = 0; x < shape[y].length; x++) {
                    if (shape[y][x]) {
                        const boardX = newX + x;
                        const boardY = newY + y;
                        
                        if (boardX < 0 || boardX >= CONFIG.BOARD_WIDTH || 
                            boardY >= CONFIG.BOARD_HEIGHT || 
                            (boardY >= 0 && gameState.board[boardY][boardX])) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }

        // Mover pe√ßa
        function movePiece(dx, dy) {
            if (!gameState.currentPiece) return false;
            
            const newX = gameState.currentPiece.x + dx;
            const newY = gameState.currentPiece.y + dy;
            
            if (isValidMove(gameState.currentPiece, newX, newY)) {
                gameState.currentPiece.x = newX;
                gameState.currentPiece.y = newY;
                
                if (dy > 0) {
                    gameState.score += CONFIG.POINTS.SOFT_DROP;
                    updateDisplay();
                }
                return true;
            }
            return false;
        }

        // Rotacionar pe√ßa
        function rotatePiece() {
            if (!gameState.currentPiece) return;
            
            const rotated = gameState.currentPiece.shape[0].map((_, index) =>
                gameState.currentPiece.shape.map(row => row[index]).reverse()
            );
            
            if (isValidMove(gameState.currentPiece, gameState.currentPiece.x, gameState.currentPiece.y, rotated)) {
                gameState.currentPiece.shape = rotated;
                playSound('rotate');
            }
        }

        // Hard Drop
        function hardDrop() {
            if (!gameState.currentPiece) return;
            
            let dropDistance = 0;
            while (movePiece(0, 1)) {
                dropDistance++;
            }
            
            gameState.score += dropDistance * CONFIG.POINTS.HARD_DROP;
            updateDisplay();
            placePiece();
            playSound('hardDrop');
        }

        // Fixar pe√ßa no tabuleiro
        function placePiece() {
            if (!gameState.currentPiece) return;
            
            for (let y = 0; y < gameState.currentPiece.shape.length; y++) {
                for (let x = 0; x < gameState.currentPiece.shape[y].length; x++) {
                    if (gameState.currentPiece.shape[y][x]) {
                        const boardY = gameState.currentPiece.y + y;
                        const boardX = gameState.currentPiece.x + x;
                        
                        if (boardY >= 0 && boardY < CONFIG.BOARD_HEIGHT && 
                            boardX >= 0 && boardX < CONFIG.BOARD_WIDTH) {
                            gameState.board[boardY][boardX] = gameState.currentPiece.shape[y][x];
                        }
                    }
                }
            }
            
            const linesCleared = clearLines();
            gameState.currentPiece = gameState.nextPiece;
            gameState.nextPiece = createPiece();
            
            if (!isValidMove(gameState.currentPiece, gameState.currentPiece.x, gameState.currentPiece.y)) {
                gameOver();
            }
            
            playSound('place');
        }

        // Limpar linhas completas
        function clearLines() {
            let linesCleared = 0;
            const clearedRows = [];
            
            for (let y = CONFIG.BOARD_HEIGHT - 1; y >= 0; y--) {
                if (gameState.board[y].every(cell => cell !== 0)) {
                    clearedRows.push(y);
                    gameState.board.splice(y, 1);
                    gameState.board.unshift(Array(CONFIG.BOARD_WIDTH).fill(0));
                    linesCleared++;
                    y++; // Verificar a mesma linha novamente
                }
            }
            
            if (linesCleared > 0) {
                // Criar efeitos de part√≠culas
                clearedRows.forEach(row => createParticles(row));
                
                gameState.lines += linesCleared;
                
                // Sistema de pontua√ß√£o baseado em combos
                let points = 0;
                switch (linesCleared) {
                    case 1: points = CONFIG.POINTS.SINGLE; break;
                    case 2: points = CONFIG.POINTS.DOUBLE; break;
                    case 3: points = CONFIG.POINTS.TRIPLE; break;
                    case 4: points = CONFIG.POINTS.TETRIS; break;
                }
                
                // Bonus por combo
                gameState.combo++;
                points *= gameState.combo;
                
                // Bonus por n√≠vel
                points *= gameState.level;
                
                gameState.score += points;
                gameState.level = Math.floor(gameState.lines / CONFIG.LINES_PER_LEVEL) + 1;
                
                updateDisplay();
                playSound('lineClear');
            } else {
                gameState.combo = 0;
            }
            
            return linesCleared;
        }

        // Criar efeitos de part√≠culas
        function createParticles(row) {
            const gameRect = canvas.getBoundingClientRect();
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = (gameRect.left + Math.random() * gameRect.width) + 'px';
                particle.style.top = (gameRect.top + (row * CONFIG.BLOCK_SIZE)) + 'px';
                particle.style.animationDelay = (Math.random() * 0.5) + 's';
                
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 1000);
            }
        }

        // Desenhar bloco com efeito visual
        function drawBlock(context, x, y, color, blockSize = CONFIG.BLOCK_SIZE) {
            if (!color || color === 0) return;
            
            // Cor principal
            context.fillStyle = COLORS[color];
            context.fillRect(x * blockSize, y * blockSize, blockSize, blockSize);
            
            // Borda externa
            context.strokeStyle = '#ffffff';
            context.lineWidth = 2;
            context.strokeRect(x * blockSize, y * blockSize, blockSize, blockSize);
            
            // Efeito de brilho
            const gradient = context.createLinearGradient(
                x * blockSize, 
                y * blockSize, 
                x * blockSize + blockSize/2, 
                y * blockSize + blockSize/2
            );
            gradient.addColorStop(0, 'rgba(255,255,255,0.3)');
            gradient.addColorStop(1, 'rgba(255,255,255,0)');
            
            context.fillStyle = gradient;
            context.fillRect(x * blockSize, y * blockSize, blockSize/2, blockSize/2);
        }

        // Desenhar tabuleiro
        function drawBoard() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Desenhar grid de fundo
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 1;
            for (let x = 0; x <= CONFIG.BOARD_WIDTH; x++) {
                ctx.beginPath();
                ctx.moveTo(x * CONFIG.BLOCK_SIZE, 0);
                ctx.lineTo(x * CONFIG.BLOCK_SIZE, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y <= CONFIG.BOARD_HEIGHT; y++) {
                ctx.beginPath();
                ctx.moveTo(0, y * CONFIG.BLOCK_SIZE);
                ctx.lineTo(canvas.width, y * CONFIG.BLOCK_SIZE);
                ctx.stroke();
            }
            
            // Desenhar blocos fixos
            for (let y = 0; y < CONFIG.BOARD_HEIGHT; y++) {
                for (let x = 0; x < CONFIG.BOARD_WIDTH; x++) {
                    if (gameState.board[y][x]) {
                        drawBlock(ctx, x, y, gameState.board[y][x]);
                    }
                }
            }
        }

        // Desenhar pe√ßa
        function drawPiece(piece) {
            if (!piece || !piece.shape) return;
            
            for (let y = 0; y < piece.shape.length; y++) {
                for (let x = 0; x < piece.shape[y].length; x++) {
                    if (piece.shape[y][x]) {
                        drawBlock(ctx, piece.x + x, piece.y + y, piece.shape[y][x]);
                    }
                }
            }
        }

        // Desenhar pr√≥xima pe√ßa
        function drawNextPiece() {
            nextCtx.clearRect(0, 0, nextCanvas.width, nextCanvas.height);
            
            if (!gameState.nextPiece || !gameState.nextPiece.shape) return;
            
            const pieceWidth = gameState.nextPiece.shape[0].length;
            const pieceHeight = gameState.nextPiece.shape.length;
            const blockSize = 20;
            const startX = Math.floor((nextCanvas.width/blockSize - pieceWidth) / 2);
            const startY = Math.floor((nextCanvas.height/blockSize - pieceHeight) / 2);
            
            for (let y = 0; y < gameState.nextPiece.shape.length; y++) {
                for (let x = 0; x < gameState.nextPiece.shape[y].length; x++) {
                    if (gameState.nextPiece.shape[y][x]) {
                        drawBlock(nextCtx, startX + x, startY + y, gameState.nextPiece.shape[y][x], blockSize);
                    }
                }
            }
        }

        // Atualizar display
        function updateDisplay() {
            document.getElementById('score').textContent = gameState.score.toLocaleString();
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('lines').textContent = gameState.lines;
        }

        // Loop principal do jogo
        function gameLoop(time = 0) {
            const deltaTime = time - gameState.lastTime;
            gameState.lastTime = time;
            
            if (gameState.gameRunning && !gameState.paused) {
                gameState.dropTime += deltaTime;
                
                const dropInterval = Math.max(
                    CONFIG.DROP_INTERVAL_MIN, 
                    CONFIG.DROP_INTERVAL_BASE - (gameState.level - 1) * CONFIG.LEVEL_SPEED_INCREASE
                );
                
                if (gameState.dropTime > dropInterval) {
                    if (!movePiece(0, 1)) {
                        placePiece();
                    }
                    gameState.dropTime = 0;
                }
                
                // Desenhar tudo
                drawBoard();
                drawPiece(gameState.currentPiece);
                drawNextPiece();
            }
            
            requestAnimationFrame(gameLoop);
        }

        // Gerenciamento de telas
        function showScreen(screenId) {
            const screens = ['menuScreen', 'gameOverScreen', 'pauseScreen', 'highScoresScreen', 'instructionsScreen'];
            screens.forEach(id => {
                const screen = document.getElementById(id);
                if (screen) {
                    screen.style.display = id === screenId ? 'flex' : 'none';
                }
            });
        }

        function showMenu() {
            gameState.gameRunning = false;
            gameState.paused = false;
            showScreen('menuScreen');
        }

        function showHighScores() {
            displayHighScores();
            showScreen('highScoresScreen');
        }

        function showInstructions() {
            showScreen('instructionsScreen');
        }

        // Iniciar jogo
        function startGame() {
            gameState.reset();
            gameState.currentPiece = createPiece();
            gameState.nextPiece = createPiece();
            gameState.gameRunning = true;
            gameState.paused = false;
            
            showScreen(null);
            updateDisplay();
            loadCharacterImage();
        }

        // Reiniciar jogo
        function restartGame() {
            startGame();
        }

        // Game Over
        function gameOver() {
            gameState.gameRunning = false;
            
            document.getElementById('finalScore').textContent = gameState.score.toLocaleString();
            document.getElementById('finalLevel').textContent = gameState.level;
            document.getElementById('finalLines').textContent = gameState.lines;
            
            saveHighScore(gameState.score, gameState.level, gameState.lines);
            showScreen('gameOverScreen');
            playSound('gameOver');
        }

        // Pausar/Despausar
        function togglePause() {
            if (!gameState.gameRunning) return;
            
            gameState.paused = !gameState.paused;
            if (gameState.paused) {
                showScreen('pauseScreen');
            } else {
                showScreen(null);
            }
        }

        // Sistema de recordes
        function saveHighScore(score, level, lines) {
            let highScores = JSON.parse(localStorage.getItem('tetrisHighScores') || '[]');
            
            highScores.push({
                score: score,
                level: level,
                lines: lines,
                date: new Date().toLocaleDateString()
            });
            
            highScores.sort((a, b) => b.score - a.score);
            highScores = highScores.slice(0, 10); // Manter apenas top 10
            
            localStorage.setItem('tetrisHighScores', JSON.stringify(highScores));
        }

        function loadHighScores() {
            return JSON.parse(localStorage.getItem('tetrisHighScores') || '[]');
        }

        function displayHighScores() {
            const highScores = loadHighScores();
            const container = document.getElementById('highScoresList');
            
            if (highScores.length === 0) {
                container.innerHTML = '<p>Nenhum recorde ainda!</p>';
                return;
            }
            
            container.innerHTML = highScores.map((score, index) => `
                <div class="score-entry">
                    <span>${index + 1}¬∫</span>
                    <span>${score.score.toLocaleString()} pts</span>
                    <span>Nv.${score.level}</span>
                    <span>${score.date}</span>
                </div>
            `).join('');
        }

        // Sistema de √°udio
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                playBackgroundMusic();
            } catch (e) {
                console.log('√Åudio n√£o dispon√≠vel');
            }
        }

        function playBackgroundMusic() {
            if (isPlayingMusic || !audioContext) return;
            
            isPlayingMusic = true;
            const notes = [262, 294, 330, 349, 392, 440, 494, 523];
            let noteIndex = 0;
            
            function playNote() {
                if (!gameState.gameRunning || gameState.paused) {
                    setTimeout(playNote, 500);
                    return;
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(notes[noteIndex], audioContext.currentTime);
                oscillator.type = 'square';
                
                gainNode.gain.setValueAtTime(0.03, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
                
                noteIndex = (noteIndex + 1) % notes.length;
                
                setTimeout(playNote, 600);
            }
            
            playNote();
        }

        function playSound(type) {
            if (!audioContext) return;
            
            const sounds = {
                rotate: { freq: 400, duration: 0.1 },
                place: { freq: 300, duration: 0.2 },
                lineClear: { freq: 800, duration: 0.3 },
                hardDrop: { freq: 200, duration: 0.15 },
                gameOver: { freq: 150, duration: 0.5 }
            };
            
            const sound = sounds[type];
            if (!sound) return;
            
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.connect(gain);
            gain.connect(audioContext.destination);
            
            osc.frequency.setValueAtTime(sound.freq, audioContext.currentTime);
            osc.type = 'square';
            
            gain.gain.setValueAtTime(0.1, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + sound.duration);
            
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + sound.duration);
        }

        // Carregar imagem do personagem
        function loadCharacterImage() {
            const img = new Image();
            img.onload = function() {
                const characterDiv = document.getElementById('characterImage');
                characterDiv.style.backgroundImage = `url('imagemdaniel.png')`;
                characterDiv.style.backgroundSize = 'cover';
                characterDiv.style.backgroundPosition = 'center';
                characterDiv.innerHTML = '';
            };
            img.onerror = function() {
                console.log('Imagem imagemdaniel.png n√£o encontrada');
            };
            img.src = 'imagemdaniel.png';
        }

        // Inicializar quando a p√°gina carregar
        window.addEventListener('load', () => {
            initGame();
            gameLoop();
        });
    </script>
</body>
</html>

